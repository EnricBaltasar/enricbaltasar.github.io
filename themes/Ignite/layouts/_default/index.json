{{- $index := slice -}}
{{- range where .Site.RegularPages "Type" "in" (site.Params.mainSections | default (slice "posts")) -}}
  {{- if not .Params.external_url -}}
    {{- $entry := dict
      "title" .Title
      "permalink" .Permalink
      "summary" (.Summary | plainify | htmlUnescape)
      "content" (.Plain | htmlUnescape | truncate 500)
      "date" (.Date | time.Format "January 2, 2006")
    -}}
    {{- $index = $index | append $entry -}}
  {{- end -}}
{{- end -}}
{{- $index | jsonify -}}
